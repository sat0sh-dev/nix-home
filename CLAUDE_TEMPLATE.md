# CLAUDE.md - AI作業契約

> **このファイルの目的**: Claude CodeとOllama + aiderの両方が参照する「真の記憶」として、プロジェクトの文脈・方針・進捗を記録します。

---

## プロジェクト概要

### プロジェクト名
[プロジェクト名を記載]

### 目的
[このプロジェクトが解決する問題、達成する目標を簡潔に記載]

### 技術スタック
- **言語**: [Python 3.11 / Rust / TypeScript など]
- **フレームワーク**: [Django / Actix / Next.js など]
- **データベース**: [PostgreSQL / SQLite など]
- **その他**: [Redis / Docker / Kubernetes など]

---

## 開発方針

### コーディング規約
- [命名規則: snake_case / camelCase など]
- [インデント: スペース4つ / タブ など]
- [コメント規則: docstring必須 / 最小限 など]

### テスト方針
- [テスト駆動開発（TDD）/ 実装後テスト など]
- [カバレッジ目標: 80%以上 など]
- [テストフレームワーク: pytest / Jest など]

### Git運用
- [ブランチ戦略: Git Flow / GitHub Flow など]
- [コミットメッセージ: Conventional Commits など]
- [PR/MRルール: レビュー必須 / CI通過必須 など]

---

## 現在の作業

### フェーズ
[例: Phase 1: MVP開発 / Phase 2: リファクタリング など]

### 優先タスク
1. [最優先タスク]
2. [次に重要なタスク]
3. [その他のタスク]

### 直近の変更履歴
**日付: YYYY-MM-DD**
- [変更内容の概要]
- [技術的な決定事項]
- [残課題]

---

## アーキテクチャ

### ディレクトリ構造
```
project/
├── src/           # [説明]
├── tests/         # [説明]
├── docs/          # [説明]
└── README.md      # [説明]
```

### 重要なモジュール
- **`src/main.py`**: [役割の説明]
- **`src/auth.py`**: [役割の説明]
- **`src/database.py`**: [役割の説明]

### データフロー
[データの流れ、API呼び出しパターンなどを図解または箇条書きで]

---

## 依存関係とセットアップ

### 開発環境
```bash
# Nix flakeを使用（推奨）
nix develop

# または直接インストール
pip install -r requirements.txt
```

### 環境変数
```bash
DATABASE_URL=postgresql://localhost/mydb
SECRET_KEY=your-secret-key
DEBUG=true
```

### 初回セットアップ
```bash
# データベースマイグレーション
./manage.py migrate

# テストデータ投入
./manage.py loaddata fixtures/test_data.json
```

---

## テストとCI

### テストの実行
```bash
# 全テスト実行
pytest

# 特定のテスト
pytest tests/test_auth.py

# カバレッジ
pytest --cov=src --cov-report=html
```

### CI/CDパイプライン
- [GitHub Actions / GitLab CI など]
- [ステージング環境 / 本番環境 など]

---

## 既知の問題と制約

### 技術的負債
1. [負債の内容]
   - 理由: [なぜ発生したか]
   - 影響: [どこに影響するか]
   - 対策: [いつ・どう解消するか]

### 制限事項
- [パフォーマンス制約]
- [セキュリティ考慮事項]
- [ブラウザ/OS互換性]

---

## AI作業の注意事項

### Claude Code / aider共通ルール
1. **破壊的変更の禁止**: 既存機能を壊さないこと
2. **テスト必須**: 実装後は必ずテストを実行
3. **コミット粒度**: 機能単位で小刻みにcommit
4. **ドキュメント更新**: コード変更時はこのCLAUDE.mdも更新

### フォールバック時の方針
Ollama + aiderにフォールバックした場合：
- ✅ **許可**: 小規模なバグ修正、リファクタリング、コメント追加
- ⚠️ **要確認**: 新機能追加、API変更、データモデル変更
- ❌ **禁止**: セキュリティ関連の変更、本番環境への直接デプロイ

---

## 参考資料

### 内部ドキュメント
- [設計書へのリンク]
- [API仕様書へのリンク]

### 外部リソース
- [公式ドキュメント]
- [参考にした記事/リポジトリ]

---

## 更新履歴

| 日付 | 更新者 | 内容 |
|------|--------|------|
| YYYY-MM-DD | [名前/AI] | [変更内容] |

---

**このファイルは常に最新に保つこと**

AIが参照する唯一の信頼できる情報源です。作業前後に必ず更新してください。
